<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Metadata - Flatcar Container Linux Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Flatcar Container Linux Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li >
                            <a href="../..">Home</a>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li >
                            <a href="../../os/quickstart/">Quick start</a>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Navigation <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                
  <li class="dropdown-submenu">
    <a href="#">Provisioning</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/provisioning/">Using Container Linux Config</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/overview/">Using Config Transpiler</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/dynamic-data/">CL Config Dynamic Data</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/examples/">CL Config Examples</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/configuration/">CL Config Spec</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Cloud Providers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/booting-on-ec2/">Amazon EC2</a>
</li>
            
<li >
    <a href="../../os/booting-on-azure/">Azure</a>
</li>
            
<li >
    <a href="../../os/booting-on-digitalocean/">Digital Ocean</a>
</li>
            
<li >
    <a href="../../os/booting-on-google-compute-engine/">Google Compute Engine</a>
</li>
            
<li >
    <a href="../../os/booting-with-qemu/">QEMU</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Bare Metal</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/booting-with-ipxe/">Booting with iPXE</a>
</li>
            
<li >
    <a href="../../os/booting-with-pxe/">Booting with PXE</a>
</li>
            
<li >
    <a href="../../os/installing-to-disk/">Installing to Disk</a>
</li>
            
<li >
    <a href="../../os/booting-with-iso/">Booting from ISO</a>
</li>
            
<li >
    <a href="../../os/root-filesystem-placement/">Root filesystem placement</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Migrating from CoreOS Container Linux</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/migrate-from-container-linux/">Migrating from CoreOS Container Linux</a>
</li>
            
<li >
    <a href="../../os/update-from-container-linux/">Updating from CoreOS Container Linux</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Working with Clusters</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Creating Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/cluster-architectures/">Cluster architectures</a>
</li>
            
<li >
    <a href="../../os/update-strategies/">Update strategies</a>
</li>
            
<li >
    <a href="../../os/cluster-discovery/">Clustering machines</a>
</li>
            
<li >
    <a href="../../os/verify-images/">Verify Flatcar Container Linux Images with GPG</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Customizing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/network-config-with-networkd/">Using networkd to customize networking</a>
</li>
            
<li >
    <a href="../../os/using-systemd-drop-in-units/">Using systemd drop-in units</a>
</li>
            
<li >
    <a href="../../os/using-environment-variables-in-systemd-units/">Using environment variables in systemd units</a>
</li>
            
<li >
    <a href="../../os/configuring-dns/">Configuring DNS</a>
</li>
            
<li >
    <a href="../../os/configuring-date-and-timezone/">Configuring date & timezone</a>
</li>
            
<li >
    <a href="../../os/adding-users/">Adding users</a>
</li>
            
<li >
    <a href="../../os/other-settings/">Kernel modules / sysctl parameters</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Scaling Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/adding-disk-space/">Adding disk space</a>
</li>
            
<li >
    <a href="../../os/mounting-storage/">Mounting storage</a>
</li>
            
<li >
    <a href="../../os/power-management/">Power management</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Managing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/registry-authentication/">Registry authentication</a>
</li>
            
<li >
    <a href="../../os/iscsi/">iSCSI configuration</a>
</li>
            
<li >
    <a href="../../os/adding-swap/">Adding swap</a>
</li>
            
<li >
    <a href="../../os/booting-on-ecs/">Amazon EC2 Container Service</a>
</li>
            
<li >
    <a href="../../os/getting-started-with-systemd/">Using systemd to manage Docker containers</a>
</li>
            
<li >
    <a href="../../os/using-systemd-and-udev-rules/">Using systemd and udev rules</a>
</li>
            
<li >
    <a href="../../os/switching-channels/">Switching release channels</a>
</li>
            
<li >
    <a href="../../os/scheduling-tasks-with-systemd-timers/">Scheduling tasks with systemd</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Securing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/customizing-sshd/">Customizing the SSH daemon</a>
</li>
            
<li >
    <a href="../../os/sssd/">Configuring SSSD on Flatcar Container Linux</a>
</li>
            
<li >
    <a href="../../os/hardening-guide/">Hardening a Flatcar Container Linux machine</a>
</li>
            
<li >
    <a href="../../os/trusted-computing-hardware-requirements/">Trusted Computing Hardware Requirements</a>
</li>
            
<li >
    <a href="../../os/adding-certificate-authorities/">Adding Cert Authorities</a>
</li>
            
<li >
    <a href="../../os/selinux/">Using SELinux</a>
</li>
            
<li >
    <a href="../../os/disabling-smt/">Disabling SMT</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Debugging Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/install-debugging-tools/">Install debugging tools</a>
</li>
            
<li >
    <a href="../../os/btrfs-troubleshooting/">Working with btrfs</a>
</li>
            
<li >
    <a href="../../os/reading-the-system-log/">Reading the system log</a>
</li>
            
<li >
    <a href="../../os/collecting-crash-logs/">Collecting crash logs</a>
</li>
            
<li >
    <a href="../../os/manual-rollbacks/">Manual Flatcar Container Linux rollbacks</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Container Runtimes</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Docker</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/getting-started-with-docker/">Getting started with Docker</a>
</li>
            
<li >
    <a href="../../os/customizing-docker/">Customizing Docker</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                            </ul>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../boot-process/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../network-configuration/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#metadata">Metadata</a></li>
            <li><a href="#etcd2-with-coreos-metadata">etcd2 with coreos-metadata</a></li>
            <li><a href="#custom-metadata-agent">Custom metadata agent</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="metadata">Metadata<a class="headerlink" href="#metadata" title="Permanent link">&para;</a></h1>
<p>In many cases, it is desirable to inject dynamic data into services written by Ignition. Because Ignition itself is static and cannot inject dynamic data into configs, this must be done as the system starts. Flatcar Container Linux ships with a small utility, <code class="codehilite">coreos-metadata</code>, which fetches information specific to the environment in which Flatcar Container Linux is running. While this utility works only on officially supported platforms, it is possible to use the same paradigm to write a custom utility.</p>
<p>Each of these examples is written in version 2.0.0 of the config. Ensure that any configuration matches the version that Ignition expects.</p>
<h2 id="etcd2-with-coreos-metadata">etcd2 with coreos-metadata<a class="headerlink" href="#etcd2-with-coreos-metadata" title="Permanent link">&para;</a></h2>
<p>This config will write a systemd drop-in (shown below) for the etcd2.service. The drop-in modifies the ExecStart option, adding a few flags to etcd2's invocation. These flags use variables defined by coreos-metadata.service to change the interfaces on which etcd2 listens. coreos-metadata is provided by Flatcar Container Linux and will read the appropriate metadata for the cloud environment (AWS in this example) and write the results to <code class="codehilite">/run/metadata/coreos</code>. For more information on the supported platforms and environment variables, refer to the <a href="https://github.com/flatcar-linux/afterburn/blob/master/docs/container-linux-legacy.md">coreos-metadata documentation</a>.</p>
<pre class="codehilite"><code class="language-json">{
  &quot;ignition&quot;: { &quot;version&quot;: &quot;2.0.0&quot; },
  &quot;systemd&quot;: {
    &quot;units&quot;: [{
      &quot;name&quot;: &quot;etcd2.service&quot;,
      &quot;enable&quot;: true,
      &quot;dropins&quot;: [{
        &quot;name&quot;: &quot;metadata.conf&quot;,
        &quot;contents&quot;: &quot;[Unit]\nRequires=coreos-metadata.service\nAfter=coreos-metadata.service\n\n[Service]\nEnvironmentFile=/run/metadata/coreos\nExecStart=\nExecStart=/usr/bin/etcd2 --advertise-client-urls=http://${COREOS_EC2_IPV4_PUBLIC}:2379 --initial-advertise-peer-urls=http://${COREOS_EC2_IPV4_LOCAL}:2380 --listen-client-urls=http://0.0.0.0:2379 --listen-peer-urls=http://${COREOS_EC2_IPV4_LOCAL}:2380 --initial-cluster=%m=http://${COREOS_EC2_IPV4_LOCAL}:2380&quot;
      }]
    }]
  }
}</code></pre>

<h3 id="metadataconf">metadata.conf<a class="headerlink" href="#metadataconf" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-ini">[Unit]
Requires=coreos-metadata.service
After=coreos-metadata.service

[Service]
EnvironmentFile=/run/metadata/coreos
ExecStart=
ExecStart=/usr/bin/etcd2 \
  --advertise-client-urls=http://${COREOS_EC2_IPV4_PUBLIC}:2379 \
  --initial-advertise-peer-urls=http://${COREOS_EC2_IPV4_LOCAL}:2380 \
  --listen-client-urls=http://0.0.0.0:2379 \
  --listen-peer-urls=http://${COREOS_EC2_IPV4_LOCAL}:2380 \
  --initial-cluster=%m=http://${COREOS_EC2_IPV4_LOCAL}:2380</code></pre>

<h2 id="custom-metadata-agent">Custom metadata agent<a class="headerlink" href="#custom-metadata-agent" title="Permanent link">&para;</a></h2>
<p>When Flatcar Container Linux is used outside of a supported cloud environment (for example, in a PXE booted, bare metal installation), coreos-metadata won't work. However, it is possible to write a custom metadata service.</p>
<p>This config will write a single service unit with the contents of a metadata agent service (shown below). This unit will not start on its own, because it is not enabled and is not a dependency of any other units. This metadata agent will fetch instance metadata from EC2 and save it to an ephemeral file.</p>
<pre class="codehilite"><code class="language-json">{
  &quot;ignition&quot;: { &quot;version&quot;: &quot;2.0.0&quot; },
  &quot;systemd&quot;: {
    &quot;units&quot;: [{
      &quot;name&quot;: &quot;metadata.service&quot;,
      &quot;contents&quot;: &quot;[Unit]\nDescription=EC2 metadata agent\n\n[Service]\nType=oneshot\nEnvironment=OUTPUT=/run/metadata/ec2\nExecStart=/usr/bin/mkdir --parent /run/metadata\nExecStart=/usr/bin/bash -c 'echo \&quot;CUSTOM_EC2_IPV4_PUBLIC=$(curl --url http://169.254.169.254/2009-04-04/meta-data/public-ipv4 --retry 10)\\nCUSTOM_EC2_IPV4_LOCAL=$(curl --url http://169.254.169.254/2009-04-04/meta-data/local-ipv4 --retry 10)\&quot; &gt; ${OUTPUT}'\n&quot;
    }]
  }
}</code></pre>

<h3 id="metadataservice">metadata.service<a class="headerlink" href="#metadataservice" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-ini">[Unit]
Description=EC2 metadata agent

[Service]
Type=oneshot
Environment=OUTPUT=/run/metadata/ec2
ExecStart=/usr/bin/mkdir --parent /run/metadata
ExecStart=/usr/bin/bash -c 'echo &quot;CUSTOM_EC2_IPV4_PUBLIC=$(curl\
  --url http://169.254.169.254/2009-04-04/meta-data/public-ipv4\
  --retry 10)\nCUSTOM_EC2_IPV4_LOCAL=$(curl\
  --url http://169.254.169.254/2009-04-04/meta-data/local-ipv4\
  --retry 10)&quot; &gt; ${OUTPUT}'</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>

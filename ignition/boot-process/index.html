<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Flatcar Container Linux startup process - Flatcar Container Linux Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Flatcar Container Linux Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li >
                            <a href="../..">Home</a>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li >
                            <a href="../../os/quickstart/">Quick start</a>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Navigation <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                
  <li class="dropdown-submenu">
    <a href="#">Provisioning</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/provisioning/">Using Container Linux Config</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/overview/">Using Config Transpiler</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/dynamic-data/">CL Config Dynamic Data</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/examples/">CL Config Examples</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/configuration/">CL Config Spec</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Cloud Providers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/booting-on-ec2/">Amazon EC2</a>
</li>
            
<li >
    <a href="../../os/booting-on-azure/">Azure</a>
</li>
            
<li >
    <a href="../../os/booting-on-digitalocean/">Digital Ocean</a>
</li>
            
<li >
    <a href="../../os/booting-on-google-compute-engine/">Google Compute Engine</a>
</li>
            
<li >
    <a href="../../os/booting-with-qemu/">QEMU</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Bare Metal</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/booting-with-ipxe/">Booting with iPXE</a>
</li>
            
<li >
    <a href="../../os/booting-with-pxe/">Booting with PXE</a>
</li>
            
<li >
    <a href="../../os/installing-to-disk/">Installing to Disk</a>
</li>
            
<li >
    <a href="../../os/booting-with-iso/">Booting from ISO</a>
</li>
            
<li >
    <a href="../../os/root-filesystem-placement/">Root filesystem placement</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Migrating from CoreOS Container Linux</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/migrate-from-container-linux/">Migrating from CoreOS Container Linux</a>
</li>
            
<li >
    <a href="../../os/update-from-container-linux/">Updating from CoreOS Container Linux</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Working with Clusters</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Creating Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/cluster-architectures/">Cluster architectures</a>
</li>
            
<li >
    <a href="../../os/update-strategies/">Update strategies</a>
</li>
            
<li >
    <a href="../../os/cluster-discovery/">Clustering machines</a>
</li>
            
<li >
    <a href="../../os/verify-images/">Verify Flatcar Container Linux Images with GPG</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Customizing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/network-config-with-networkd/">Using networkd to customize networking</a>
</li>
            
<li >
    <a href="../../os/using-systemd-drop-in-units/">Using systemd drop-in units</a>
</li>
            
<li >
    <a href="../../os/using-environment-variables-in-systemd-units/">Using environment variables in systemd units</a>
</li>
            
<li >
    <a href="../../os/configuring-dns/">Configuring DNS</a>
</li>
            
<li >
    <a href="../../os/configuring-date-and-timezone/">Configuring date & timezone</a>
</li>
            
<li >
    <a href="../../os/adding-users/">Adding users</a>
</li>
            
<li >
    <a href="../../os/other-settings/">Kernel modules / sysctl parameters</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Scaling Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/adding-disk-space/">Adding disk space</a>
</li>
            
<li >
    <a href="../../os/mounting-storage/">Mounting storage</a>
</li>
            
<li >
    <a href="../../os/power-management/">Power management</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Managing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/registry-authentication/">Registry authentication</a>
</li>
            
<li >
    <a href="../../os/iscsi/">iSCSI configuration</a>
</li>
            
<li >
    <a href="../../os/adding-swap/">Adding swap</a>
</li>
            
<li >
    <a href="../../os/booting-on-ecs/">Amazon EC2 Container Service</a>
</li>
            
<li >
    <a href="../../os/getting-started-with-systemd/">Using systemd to manage Docker containers</a>
</li>
            
<li >
    <a href="../../os/using-systemd-and-udev-rules/">Using systemd and udev rules</a>
</li>
            
<li >
    <a href="../../os/switching-channels/">Switching release channels</a>
</li>
            
<li >
    <a href="../../os/scheduling-tasks-with-systemd-timers/">Scheduling tasks with systemd</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Securing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/customizing-sshd/">Customizing the SSH daemon</a>
</li>
            
<li >
    <a href="../../os/sssd/">Configuring SSSD on Flatcar Container Linux</a>
</li>
            
<li >
    <a href="../../os/hardening-guide/">Hardening a Flatcar Container Linux machine</a>
</li>
            
<li >
    <a href="../../os/trusted-computing-hardware-requirements/">Trusted Computing Hardware Requirements</a>
</li>
            
<li >
    <a href="../../os/adding-certificate-authorities/">Adding Cert Authorities</a>
</li>
            
<li >
    <a href="../../os/selinux/">Using SELinux</a>
</li>
            
<li >
    <a href="../../os/disabling-smt/">Disabling SMT</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Debugging Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/install-debugging-tools/">Install debugging tools</a>
</li>
            
<li >
    <a href="../../os/btrfs-troubleshooting/">Working with btrfs</a>
</li>
            
<li >
    <a href="../../os/reading-the-system-log/">Reading the system log</a>
</li>
            
<li >
    <a href="../../os/collecting-crash-logs/">Collecting crash logs</a>
</li>
            
<li >
    <a href="../../os/manual-rollbacks/">Manual Flatcar Container Linux rollbacks</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Container Runtimes</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Docker</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os/getting-started-with-docker/">Getting started with Docker</a>
</li>
            
<li >
    <a href="../../os/customizing-docker/">Customizing Docker</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                            </ul>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../../container-linux-config-transpiler/doc/production-users/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../metadata/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#flatcar-container-linux-startup-process">Flatcar Container Linux startup process</a></li>
            <li><a href="#bootloader">Bootloader</a></li>
            <li><a href="#early-user-space">Early user space</a></li>
            <li><a href="#user-space">User space</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="flatcar-container-linux-startup-process">Flatcar Container Linux startup process<a class="headerlink" href="#flatcar-container-linux-startup-process" title="Permanent link">&para;</a></h1>
<p>The Flatcar Container Linux startup process is built on the standard <a href="https://en.wikipedia.org/wiki/Linux_startup_process">Linux startup process</a>. Since this process is already well documented and generally well understood, this document will focus on aspects specific to booting Flatcar Container Linux.</p>
<h2 id="bootloader">Bootloader<a class="headerlink" href="#bootloader" title="Permanent link">&para;</a></h2>
<p><a href="https://www.gnu.org/software/grub/">GRUB</a> is the first program executed when a Flatcar Container Linux system boots. The Flatcar Container Linux <a href="https://github.com/flatcar-linux/scripts/blob/9e1c23f3f44d2751076e770f43f7a6db05d49652/build_library/grub.cfg">GRUB config</a> has several roles.</p>
<p>First, the GRUB config <a href="https://github.com/flatcar-linux/scripts/blob/9e1c23f3f44d2751076e770f43f7a6db05d49652/build_library/grub.cfg#L132">specifies which <code class="codehilite">usr</code> partition to use</a> from the two <code class="codehilite">usr</code> partitions Flatcar Container Linux uses to provide atomic upgrades and rollbacks.</p>
<p>Second, GRUB <a href="https://github.com/flatcar-linux/scripts/blob/9e1c23f3f44d2751076e770f43f7a6db05d49652/build_library/grub.cfg#L68-L71">checks for a file called <code class="codehilite">flatcar/first_boot</code> in the EFI System Partition</a> to determine if this is the first time a machine has booted. If that file is found, GRUB sets the <code class="codehilite">flatcar.first_boot=detected</code> Linux kernel command line parameter. This parameter is used in later stages of the boot process.</p>
<p>Finally, GRUB <a href="https://github.com/flatcar-linux/scripts/blob/9e1c23f3f44d2751076e770f43f7a6db05d49652/build_library/grub.cfg#L73-L78">searches for the initial disk GUID</a> (00000000-0000-0000-0000-000000000001) built into Flatcar Container Linux images. This GUID is randomized later in the boot process so that individual disks may be uniquely identified. If GRUB finds this GUID it sets another Linux kernel command line parameter, <code class="codehilite">flatcar.randomize_guid=00000000-0000-0000-0000-000000000001</code>.</p>
<h2 id="early-user-space">Early user space<a class="headerlink" href="#early-user-space" title="Permanent link">&para;</a></h2>
<p>After GRUB, the Flatcar Container Linux startup process moves into the initial RAM file system. The initramfs mounts the root filesystem, randomizes the disk GUID, and runs Ignition.</p>
<p>If the <code class="codehilite">flatcar.randomize_guid</code> kernel parameter is provided, the disk with the specified GUID is given a new, random GUID.</p>
<p>If the <code class="codehilite">flatcar.first_boot</code> kernel parameter is provided and non-zero, Ignition and networkd are started. networkd will use DHCP to set up temporary IP addresses and routes so that Ignition can fetch its configuration from the network.</p>
<h3 id="ignition">Ignition<a class="headerlink" href="#ignition" title="Permanent link">&para;</a></h3>
<p>When Ignition runs on Flatcar Container Linux, it reads the Linux command line, looking for <code class="codehilite">flatcar.oem.id</code>. Ignition uses this identifier to determine where to read the user-provided configuration and which provider-specific configuration to combine with the user's. This provider-specific configuration performs basic machine setup, and may include enabling <code class="codehilite">coreos-metadata-sshkeys@.service</code> (covered in more detail below).</p>
<p>After Ignition runs successfully, if <code class="codehilite">flatcar.first_boot</code> was set to the special value <code class="codehilite">detected</code>, Ignition mounts the EFI System Partition and deletes the <code class="codehilite">flatcar/first_boot</code> file.</p>
<h2 id="user-space">User space<a class="headerlink" href="#user-space" title="Permanent link">&para;</a></h2>
<p>After all of the tasks in the initramfs complete, the machine pivots into user space. It is at this point that systemd begins starting units, including, if it was enabled, <code class="codehilite">coreos-metadata-sshkeys@core.service</code>.</p>
<h3 id="ssh-keys">SSH keys<a class="headerlink" href="#ssh-keys" title="Permanent link">&para;</a></h3>
<p><code class="codehilite">coreos-metadata-sshkeys@core.service</code> is responsible for fetching SSH keys from the machine's environment. The keys are written to <code class="codehilite">~core/.ssh/authorized_keys.d/coreos-metadata</code> and <code class="codehilite">update-ssh-keys</code> is run to update <code class="codehilite">~core/.ssh/authorized_keys</code>. On cloud platforms, the keys are read from the provider's metadata service. This service is not supported on all platforms and is enabled by Ignition <em>only</em> on those which are supported.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>

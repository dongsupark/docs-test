<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Updating from CoreOS Container Linux - Flatcar Container Linux Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Flatcar Container Linux Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li >
                            <a href="../..">Home</a>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li >
                            <a href="../quickstart/">Quick start</a>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Navigation <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                
  <li class="dropdown-submenu">
    <a href="#">Provisioning</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../provisioning/">Using Container Linux Config</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/overview/">Using Config Transpiler</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/dynamic-data/">CL Config Dynamic Data</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/examples/">CL Config Examples</a>
</li>
            
<li >
    <a href="../../container-linux-config-transpiler/doc/configuration/">CL Config Spec</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Cloud Providers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../booting-on-ec2/">Amazon EC2</a>
</li>
            
<li >
    <a href="../booting-on-azure/">Azure</a>
</li>
            
<li >
    <a href="../booting-on-digitalocean/">Digital Ocean</a>
</li>
            
<li >
    <a href="../booting-on-google-compute-engine/">Google Compute Engine</a>
</li>
            
<li >
    <a href="../booting-with-qemu/">QEMU</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Bare Metal</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../booting-with-ipxe/">Booting with iPXE</a>
</li>
            
<li >
    <a href="../booting-with-pxe/">Booting with PXE</a>
</li>
            
<li >
    <a href="../installing-to-disk/">Installing to Disk</a>
</li>
            
<li >
    <a href="../booting-with-iso/">Booting from ISO</a>
</li>
            
<li >
    <a href="../root-filesystem-placement/">Root filesystem placement</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Migrating from CoreOS Container Linux</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../migrate-from-container-linux/">Migrating from CoreOS Container Linux</a>
</li>
            
<li class="active">
    <a href="./">Updating from CoreOS Container Linux</a>
</li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Working with Clusters</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Creating Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../cluster-architectures/">Cluster architectures</a>
</li>
            
<li >
    <a href="../update-strategies/">Update strategies</a>
</li>
            
<li >
    <a href="../cluster-discovery/">Clustering machines</a>
</li>
            
<li >
    <a href="../verify-images/">Verify Flatcar Container Linux Images with GPG</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Customizing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../network-config-with-networkd/">Using networkd to customize networking</a>
</li>
            
<li >
    <a href="../using-systemd-drop-in-units/">Using systemd drop-in units</a>
</li>
            
<li >
    <a href="../using-environment-variables-in-systemd-units/">Using environment variables in systemd units</a>
</li>
            
<li >
    <a href="../configuring-dns/">Configuring DNS</a>
</li>
            
<li >
    <a href="../configuring-date-and-timezone/">Configuring date & timezone</a>
</li>
            
<li >
    <a href="../adding-users/">Adding users</a>
</li>
            
<li >
    <a href="../other-settings/">Kernel modules / sysctl parameters</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Scaling Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../adding-disk-space/">Adding disk space</a>
</li>
            
<li >
    <a href="../mounting-storage/">Mounting storage</a>
</li>
            
<li >
    <a href="../power-management/">Power management</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Managing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../registry-authentication/">Registry authentication</a>
</li>
            
<li >
    <a href="../iscsi/">iSCSI configuration</a>
</li>
            
<li >
    <a href="../adding-swap/">Adding swap</a>
</li>
            
<li >
    <a href="../booting-on-ecs/">Amazon EC2 Container Service</a>
</li>
            
<li >
    <a href="../getting-started-with-systemd/">Using systemd to manage Docker containers</a>
</li>
            
<li >
    <a href="../using-systemd-and-udev-rules/">Using systemd and udev rules</a>
</li>
            
<li >
    <a href="../switching-channels/">Switching release channels</a>
</li>
            
<li >
    <a href="../scheduling-tasks-with-systemd-timers/">Scheduling tasks with systemd</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Securing Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../customizing-sshd/">Customizing the SSH daemon</a>
</li>
            
<li >
    <a href="../sssd/">Configuring SSSD on Flatcar Container Linux</a>
</li>
            
<li >
    <a href="../hardening-guide/">Hardening a Flatcar Container Linux machine</a>
</li>
            
<li >
    <a href="../trusted-computing-hardware-requirements/">Trusted Computing Hardware Requirements</a>
</li>
            
<li >
    <a href="../adding-certificate-authorities/">Adding Cert Authorities</a>
</li>
            
<li >
    <a href="../selinux/">Using SELinux</a>
</li>
            
<li >
    <a href="../disabling-smt/">Disabling SMT</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Debugging Clusters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../install-debugging-tools/">Install debugging tools</a>
</li>
            
<li >
    <a href="../btrfs-troubleshooting/">Working with btrfs</a>
</li>
            
<li >
    <a href="../reading-the-system-log/">Reading the system log</a>
</li>
            
<li >
    <a href="../collecting-crash-logs/">Collecting crash logs</a>
</li>
            
<li >
    <a href="../manual-rollbacks/">Manual Flatcar Container Linux rollbacks</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                
  <li class="dropdown-submenu">
    <a href="#">Container Runtimes</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Docker</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../getting-started-with-docker/">Getting started with Docker</a>
</li>
            
<li >
    <a href="../customizing-docker/">Customizing Docker</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                            </ul>
                        </li>
                <!--Only display pages not under the hidden tag in mkdocs.yml-->
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../migrate-from-container-linux/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../cluster-architectures/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#updating-from-coreos-container-linux">Updating from CoreOS Container Linux</a></li>
            <li><a href="#getting-the-public-update-key">Getting the public update key</a></li>
            <li><a href="#modifying-the-configuration-files">Modifying the configuration files</a></li>
            <li><a href="#restart-service-and-reboot">Restart service and reboot</a></li>
            <li><a href="#all-steps-in-one-script">All steps in one script</a></li>
            <li><a href="#going-back-to-coreos-container-linux">Going back to CoreOS Container Linux</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="updating-from-coreos-container-linux">Updating from CoreOS Container Linux<a class="headerlink" href="#updating-from-coreos-container-linux" title="Permanent link">&para;</a></h1>
<p>If you already have CoreOS Container Linux clusters and can't or don't want to freshly install Flatcar Container Linux, you can update to Flatcar Container Linux directly from CoreOS Container Linux by performing the following steps.</p>
<p><strong>NOTE:</strong> General differences when <a href="../migrate-from-container-linux/">migrating from CoreOS Container Linux</a> also apply.</p>
<p>At <a href="#all-steps-in-one-script">the end of the section</a> you can find the <a href="../../update-to-flatcar.sh">update-to-flatcar.sh</a> script that does all steps for you.</p>
<h2 id="getting-the-public-update-key">Getting the public update key<a class="headerlink" href="#getting-the-public-update-key" title="Permanent link">&para;</a></h2>
<p>First, you need to get Flatcar's public update key:</p>
<pre class="codehilite"><code>$ curl -L -o /tmp/key https://raw.githubusercontent.com/flatcar-linux/coreos-overlay/flatcar-master/coreos-base/coreos-au-key/files/official-v2.pub.pem</code></pre>

<p>Since the <code class="codehilite">/usr</code> partition is read-only, to allow the updater to use the new key, you need to bind-mount it:</p>
<pre class="codehilite"><code>$ sudo mount --bind /tmp/key /usr/share/update_engine/update-payload-key.pub.pem</code></pre>

<h2 id="modifying-the-configuration-files">Modifying the configuration files<a class="headerlink" href="#modifying-the-configuration-files" title="Permanent link">&para;</a></h2>
<p>Now, you need to point update_engine to Flatcar's update server by setting the <code class="codehilite">SERVER</code> configuration option in <code class="codehilite">/etc/coreos/update.conf</code>:</p>
<pre class="codehilite"><code>SERVER=https://public.update.flatcar-linux.net/v1/update/</code></pre>

<p>To make sure you get an update even if you're running the same CoreOS Container Linux version as the latest Flatcar Container Linux, you need to force an update by clearing the current version number from the <code class="codehilite">release</code> file.
This file also lives in the <code class="codehilite">/usr</code> partition so you need to do a bind-mount again:</p>
<pre class="codehilite"><code>$ cp /usr/share/coreos/release /tmp
$ sudo mount --bind /tmp/release /usr/share/coreos/release</code></pre>

<p>Then, you need to edit <code class="codehilite">/usr/share/coreos/release</code> and replace the value of <code class="codehilite">COREOS_RELEASE_VERSION</code> with <code class="codehilite">0.0.0</code>:</p>
<pre class="codehilite"><code>COREOS_RELEASE_VERSION=0.0.0</code></pre>

<p><strong>NOTE:</strong> In bare metal installations, the path where <code class="codehilite">user_data</code> is expected changes from <code class="codehilite">/var/lib/coreos-install/user_data</code> to <code class="codehilite">/var/lib/flatcar-install/user_data</code>. Make sure you place your <code class="codehilite">user_data</code> in the new path.</p>
<h2 id="restart-service-and-reboot">Restart service and reboot<a class="headerlink" href="#restart-service-and-reboot" title="Permanent link">&para;</a></h2>
<p>After that, restart the update service so it rescans the edited configuration and initiates an update.
The system will reboot into Flatcar Container Linux:</p>
<pre class="codehilite"><code>$ sudo systemctl restart update-engine
$ update_engine_client -update</code></pre>

<h2 id="all-steps-in-one-script">All steps in one script<a class="headerlink" href="#all-steps-in-one-script" title="Permanent link">&para;</a></h2>
<p>The <a href="../../update-to-flatcar.sh">update-to-flatcar.sh</a> script does all required steps mentioned above for you:</p>
<pre class="codehilite"><code># To be run on the node via SSH
core@host ~ $ wget https://docs.flatcar-linux.org/update-to-flatcar.sh
core@host ~ $ less update-to-flatcar.sh # Double check the content of the script
core@host ~ $ chmod +x update-to-flatcar.sh
core@host ~ $ ./update-to-flatcar.sh
[…]
Done, please reboot now
core@host ~ $ sudo systemctl reboot</code></pre>

<p><strong>Before you reboot, check that you migrated the variable names as written in <a href="../migrate-from-container-linux/">Migrating from CoreOS Container Linux</a>.</strong></p>
<h2 id="going-back-to-coreos-container-linux">Going back to CoreOS Container Linux<a class="headerlink" href="#going-back-to-coreos-container-linux" title="Permanent link">&para;</a></h2>
<p>You can also go the other way.</p>
<h3 id="manual-rollback">Manual rollback<a class="headerlink" href="#manual-rollback" title="Permanent link">&para;</a></h3>
<p>If you just updated to Flatcar (and haven't done any additional updates), CoreOS Container Linux will still be on your disk, you just need to roll back to the other partition.</p>
<p>To do that, just use this command composition:</p>
<pre class="codehilite"><code>$ sudo cgpt prioritize &quot;$(sudo cgpt find -t flatcar-usr | grep --invert-match &quot;$(rootdev -s /usr)&quot;)&quot;</code></pre>

<p>Now you can reboot and you'll be back to CoreOS Container Linux.
Remember to undo your changes in your <code class="codehilite">/etc/coreos/update.conf</code> after rolling back if you want to keep getting CoreOS Container Linux updates.</p>
<p>For more information about manual rollbacks, check <a href="https://coreos.com/os/docs/latest/manual-rollbacks.html#performing-a-manual-rollback">Performing a manual rollback</a>.</p>
<h3 id="force-an-update-to-coreos-container-linux">Force an update to CoreOS Container Linux<a class="headerlink" href="#force-an-update-to-coreos-container-linux" title="Permanent link">&para;</a></h3>
<p>This procedure is similar to updating from CoreOS Container Linux to Flatcar Container Linux.
You need to get CoreOS Container Linux's public key, point update_engine to CoreOS Container Linux's update server, and force an update.</p>
<p>Get CoreOS Container Linux's public key:</p>
<pre class="codehilite"><code>$ curl -L -o /tmp/key https://raw.githubusercontent.com/coreos/coreos-overlay/master/coreos-base/coreos-au-key/files/official-v2.pub.pem</code></pre>

<p>Bind-mount it:</p>
<pre class="codehilite"><code>$ sudo mount --bind /tmp/key /usr/share/update_engine/update-payload-key.pub.pem</code></pre>

<p>Create an <code class="codehilite">/etc/flatcar</code> directory and copy the current update configuration:</p>
<pre class="codehilite"><code>$ sudo mkdir -p /etc/flatcar
$ sudo cp /etc/coreos/update.conf /etc/flatcar/</code></pre>

<p>Change the <code class="codehilite">SERVER</code> field in <code class="codehilite">/etc/flatcar/update.conf</code>:</p>
<pre class="codehilite"><code>SERVER=https://public.update.core-os.net/v1/update/</code></pre>

<p>Bind-mount the release file:</p>
<pre class="codehilite"><code>$ cp /usr/share/flatcar/release /tmp
$ sudo mount --bind /tmp/release /usr/share/flatcar/release</code></pre>

<p>Edit <code class="codehilite">FLATCAR_RELEASE_VERSION</code> to force an update:</p>
<pre class="codehilite"><code>FLATCAR_RELEASE_VERSION=0.0.0</code></pre>

<p>After that, restart the update service so it rescans the edited configuration and initiates an update.
The system will reboot into CoreOS Container Linux:</p>
<pre class="codehilite"><code>$ sudo systemctl restart update-engine
$ update_engine_client -update</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
